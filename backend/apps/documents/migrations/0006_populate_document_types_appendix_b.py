"""
Data Migration: Populate DocumentTypeDefinition with Appendix B data.

This migration loads all 63 document types for Bank Guarantees (БГ)
and 68 document types for Contract Loans (КИК) from Appendix B.
"""
from django.db import migrations


def populate_document_types(apps, schema_editor):
    """Populate DocumentTypeDefinition with data from Appendix B."""
    DocumentTypeDefinition = apps.get_model('documents', 'DocumentTypeDefinition')
    
    # Clear existing data
    DocumentTypeDefinition.objects.all().delete()
    
    # =========================================================================
    # Б.1 БАНКОВСКИЕ ГАРАНТИИ (63 types)
    # =========================================================================
    bg_types = [
        # (id, name, source)
        (0, 'Дополнительный документ', 'agent_bank'),
        (17, 'Заявление', 'auto'),
        (18, 'Черновик заявления', 'auto'),
        (20, 'Бухгалтерская отчетность Ф1 и Ф2 за последний отчетный период', 'agent'),
        (21, 'Паспорт генерального директора', 'agent'),
        (24, 'Налоговая декларация за последний отчетный период', 'agent'),
        (26, 'Акт приема-передачи', 'auto'),
        (29, 'Договор поручительства ФЛ', 'auto'),
        (31, 'Пролонгация по договору Аренды', 'agent'),
        (32, 'Пояснение по завышению ЧА за отчетный период', 'agent'),
        (33, 'Договор поручительства ЮЛ', 'auto'),
        (34, 'Бухгалтерская отчетность Ф1 и Ф2 за предыдущий отчетный период', 'agent'),
        (35, 'БГ 44-ФЗ', 'auto'),
        (36, 'БГ 185-ФЗ', 'auto'),
        (37, 'БГ 223-ФЗ', 'auto'),
        (38, 'Счет на оплату', 'auto'),
        (42, 'БГ по форме заказчика', 'bank'),
        (43, 'Скан БГ', 'bank'),
        (44, 'Письмо по налогам', 'agent'),
        (45, 'Дополнительные документы', 'agent'),
        (46, 'Аукционная документация', 'agent'),
        (47, 'Проект контракта', 'agent'),
        (48, 'Протокол итогов', 'agent'),
        (49, 'Решение (протокол) о крупной сделке', 'agent'),
        (50, 'Документы на сделку', 'agent'),
        (51, 'Пояснение по ошибочным данным в ББ по предыдущим периодам', 'agent'),
        (52, 'Пояснение по несоответствию данных ББ с Росстат', 'agent'),
        (53, 'Перевыпуск', 'agent'),
        (54, 'Опыт', 'agent'),
        (55, 'Договор в обеспечении которого запрашивается БГ', 'agent'),
        (56, 'Коммерческая БГ', 'auto'),
        (60, 'Выписка из реестра', 'bank'),
        (61, 'Бухгалтерская отчетность Ф1 и Ф2 за последний завершенный год', 'agent'),
        (62, 'Бухгалтерская отчетность Ф1 и Ф2 за последний завершенный квартал', 'agent'),
        (63, 'Бухгалтерская отчетность Ф1 и Ф2 за последний завершенный год', 'agent'),
        (64, 'Бухгалтерская отчетность Ф1 и Ф2 за последний завершенный квартал', 'agent'),
        (65, 'Бухгалтерская отчетность Ф1 и Ф2 за последний завершенный квартал', 'agent'),
        (66, 'Налоговая декларация УСН за последний год', 'agent'),
        (124, 'Индивидуальные условия', 'auto'),
        (135, 'Правки для согласования', 'agent'),
        (136, 'Заявление об отказе клиента от сделки', 'agent'),
        (149, 'Паспорт поручителя ФЛ', 'auto'),
        (151, 'Отчетность за последний отчетный год поручителя ЮЛ', 'auto'),
        (153, 'Отчетность за последний отчетный период поручителя ЮЛ', 'auto'),
        (155, 'Паспорт генерального директора поручителя ЮЛ', 'auto'),
        (156, 'Налоговая декларация за последний отчетный период поручителя ЮЛ', 'auto'),
        (158, 'Действующий договор аренды или свидетельство о собственности поручителя ЮЛ', 'auto'),
        (160, 'Устав поручителя ЮЛ', 'auto'),
        (162, 'Протокол или решение на генерального директора поручителя ЮЛ', 'auto'),
        (164, 'Заявление поручителя ЮЛ', 'auto'),
        (169, 'Доверенность на подписанта', 'agent'),
        (171, 'Паспорт подписанта', 'agent'),
    ]
    
    for doc_id, name, source in bg_types:
        DocumentTypeDefinition.objects.create(
            document_type_id=doc_id,
            product_type='bank_guarantee',
            name=name,
            source=source,
            is_active=True
        )
    
    # =========================================================================
    # Б.2 КРЕДИТЫ НА ИСПОЛНЕНИЕ КОНТРАКТОВ (68 types)
    # =========================================================================
    kik_types = [
        (0, 'Дополнительный документ', 'agent_bank'),
        (30, 'Налоговая декларация УСН за последний год', 'agent'),
        (68, 'Заявление кредит', 'auto'),
        (69, 'Налоговая декларация за завершённый год', 'agent'),
        (70, 'Бухгалтерская отчётность за последний год', 'agent'),
        (71, 'Бухгалтерская отчётность за последний квартал', 'agent'),
        (74, 'Паспорт генерального директора', 'agent'),
        (75, 'Устав + дополнения к уставу (в действующей редакции)', 'agent'),
        (76, 'Протокол (решение) об избрании Единоличного исполнительного органа', 'agent'),
        (77, 'Аукционная документация', 'agent'),
        (78, 'Проект контракта', 'agent'),
        (79, 'Протокол итогов', 'agent'),
        (80, 'Карточка 51 счета или Выписка по расчетному счету (за последние 6 мес)', 'agent'),
        (81, 'Договор аренды, подтверждающий фактическое местонахождение', 'agent'),
        (83, 'Индивидуальные условия кредит', 'auto'),
        (84, 'Заявление на предоставление транша', 'auto'),
        (85, 'Открытие расчётного счёта', 'bank'),
        (86, 'Документы на сделку', 'agent'),
        (87, 'Копия лицензии (при наличии)', 'agent'),
        (90, 'Счёт на оплату', 'auto'),
        (92, 'Договор залога прав по договору банковского счета НКЛ', 'auto'),
        (93, 'Договор поручительства НКЛ ФЛ', 'auto'),
        (94, 'Договор поручительства кредит ФЛ', 'auto'),
        (95, 'Индивидуальные условия НКЛ', 'auto'),
        (96, 'Заявление НКЛ', 'auto'),
        (97, 'Договор залога прав по договору банковского счета кредит', 'auto'),
        (102, 'Целевое использование кредитных средств', 'agent'),
        (103, 'Источники погашения', 'agent'),
        (105, 'ПРОТОКОЛ - ОБЩЕЕ (одобрение на год)', 'agent'),
        (106, 'Решение - ОБЩЕЕ (одобрение на год)', 'agent'),
        (108, 'Бухгалтерская отчётность за последний завершенный квартал', 'agent'),
        (109, 'Налоговая декларация за последний отчетный период', 'agent'),
        (115, 'Черновик заявления', 'auto'),
        (137, 'Заявление об отказе клиента от сделки', 'agent'),
        (138, 'Договор поручительства НКЛ ЮЛ', 'auto'),
        (139, 'Договор поручительства кредит ЮЛ', 'auto'),
        (140, 'Уведомление о повышении % ставки', 'auto'),
        (147, 'Договор залога прав (требования) выручки', 'auto'),
        (148, 'Договор залога прав по счету', 'auto'),
        (150, 'Паспорт поручителя ФЛ', 'auto'),
        (152, 'Отчетность за последний отчетный год поручителя ЮЛ', 'auto'),
        (154, 'Паспорт генерального директора поручителя ЮЛ', 'auto'),
        (157, 'Налоговая декларация за последний отчетный период поручителя ЮЛ', 'auto'),
        (159, 'Действующий договор аренды или свидетельство о собственности поручителя ЮЛ', 'auto'),
        (161, 'Устав поручителя ЮЛ', 'auto'),
        (163, 'Протокол или решение на генерального директора поручителя ЮЛ', 'auto'),
        (165, 'Заявление поручителя ЮЛ', 'auto'),
        (166, 'Отчетность за последний отчетный период поручителя ЮЛ', 'auto'),
        (170, 'Доверенность на подписанта', 'agent'),
        (172, 'Паспорт подписанта', 'agent'),
    ]
    
    for doc_id, name, source in kik_types:
        DocumentTypeDefinition.objects.create(
            document_type_id=doc_id,
            product_type='contract_loan',
            name=name,
            source=source,
            is_active=True
        )
    
    # Also create for tender_loan (same as contract_loan)
    for doc_id, name, source in kik_types:
        DocumentTypeDefinition.objects.create(
            document_type_id=doc_id,
            product_type='tender_loan',
            name=name,
            source=source,
            is_active=True
        )
    
    # =========================================================================
    # GENERAL TYPES (for other products)
    # =========================================================================
    general_types = [
        (0, 'Дополнительный документ', 'agent_bank'),
        (1, 'Паспорт генерального директора', 'agent'),
        (2, 'Бухгалтерская отчётность', 'agent'),
        (3, 'Налоговая декларация', 'agent'),
        (4, 'Устав', 'agent'),
        (5, 'Выписка ЕГРЮЛ', 'agent'),
        (6, 'Договор аренды', 'agent'),
        (7, 'Протокол о назначении ЕИО', 'agent'),
        (8, 'Карточка 51 счета', 'agent'),
        (9, 'Другие документы', 'agent'),
    ]
    
    other_products = ['factoring', 'leasing', 'ved', 'insurance', 'rko', 'special_account', 'corporate_credit', 'tender_support']
    
    for product in other_products:
        for doc_id, name, source in general_types:
            DocumentTypeDefinition.objects.create(
                document_type_id=doc_id,
                product_type=product,
                name=name,
                source=source,
                is_active=True
            )


def reverse_populate(apps, schema_editor):
    """Reverse migration - clear all data."""
    DocumentTypeDefinition = apps.get_model('documents', 'DocumentTypeDefinition')
    DocumentTypeDefinition.objects.all().delete()


class Migration(migrations.Migration):

    dependencies = [
        ('documents', '0005_document_type_refactor_appendix_b'),
    ]

    operations = [
        migrations.RunPython(populate_document_types, reverse_populate),
    ]
